<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Local Album</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">

  <script src="https://unpkg.com/vue@next"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  
  <style>
    .grid-item {
      width: 100%;
      padding: 5px;
      transition: all .3s;
    }

    .grid-item img {
      border-radius: 5px;
    }

    .grid-item:hover {
      transform: scale(1.3, 1.3);
      z-index: 10000;
    }

    .grid-item:hover img {
      box-shadow: 0 5px 5px rgba(0, 0, 0, .5);
    }

    @media screen and (min-width: 960px) {
      .grid-item {
        width: calc(33.33%);
      }
    }
  </style>
</head>
<body>
  <div class="p-1 pt-2">
    <div id="app" class="grid d-flex flex-wrap">
      <div class="grid-item" v-for="image in images" :key="`image-${image}`">
        <img :src="image.path" alt="" class="w-100">
      </div>
    </div>
  </div>
  <script src="https://unpkg.com/isotope-layout@3/dist/isotope.pkgd.min.js"></script>
  <script>
    const { onMounted, ref } = Vue;

    window.addEventListener('scroll', () => {
      if (document.documentElement.scrollTop + window.innerHeight >= document.documentElement.scrollHeight - 200) {
        App.load();
      }
    });

    const RawApp = {
      setup(){
        const allImages = [];
        const images = ref([]);
        let isLoad = false;
        let nextLoad = false;
        let page = 0;

        const load = () => {
          if (isLoad){
            nextLoad = true;
            return;
          }

          console.log('Start load', isLoad);

          isLoad = true;

          images.value.push.apply(images.value, allImages.slice(page * 12, (page + 1) * 12));
          page++;

          setTimeout(() => {
            var elem = document.querySelector('.grid');
            var iso = new Isotope( elem, {
              // options
              itemSelector: '.grid-item'
            });

            isLoad = false;

            if (nextLoad){
              nextLoad = false;
              load();
            }
          }, 500);
        }

        onMounted(async () => {
          const res = await axios.get('/images');
          allImages.push.apply(allImages, res.data)

          load();
        });

        return {
          images,
          load
        };
      }
    };

    const App = Vue.createApp(RawApp).mount('#app');
  </script>
</body>
</html>